# app/api/v1/endpoints/orders.py
from typing import List
from fastapi import APIRouter, Depends, HTTPException
from app.core.deps import get_current_user, get_db
from app.models.order import Order
from app.schemas.order import OrderCreate, OrderResponse
from app.crud.order import OrderCRUD

router = APIRouter()

@router.post("/", response_model=OrderResponse)
async def create_order(
    order: OrderCreate,
    current_user = Depends(get_current_user),
    db = Depends(get_db)
):
    """Create a new order"""
    # Add user ID to order
    order_data = order.dict()
    order_data["customer_id"] = str(current_user.id)
    
    return await OrderCRUD(db).create(order_data)

@router.get("/my-orders", response_model=List[OrderResponse])
async def get_user_orders(
    current_user = Depends(get_current_user),
    db = Depends(get_db)
):
    """Get all orders for the current user"""
    return await OrderCRUD(db).get_user_orders(str(current_user.id))